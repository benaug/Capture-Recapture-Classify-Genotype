Capture-recapture-classify using genotypes for individual identity

Nonspatial application of the approach used in the genotype SPIM repo, with some differences. No spatial information is used (obviously) and the observation model is different (Poisson more realistic with space, less so without). The observation model here is Bernoulli for detection then zero-truncated Poisson for number of samples given detection.

Currently there are files for M0 and Mh (regular models for microsatellites). For M0, there are versions that do (sampType in file names) and do not allow variation in genotyping error probabilities as a function of sample type covariates. Continuous covariates can be used, but I haven't provided a way to do that here. Continuous covariates require a genotype classification matrix for every sample, so it is slow. There are also M0 versions with and without sample type covariates for SNPs.

These models use N-prior data augmentation: https://github.com/benaug/SCR-N-Prior-Data-Augmentation

Some notes: 
1. I've done quite a bit of testing of the code for M0 and M0 sampType. With abundant genetic information, the estimates are unbiased with roughly nominal coverage. But there is negative bias when some or all genetic samples do not contain much information about individual ID. This can happen when you don't use enough loci to limit the shadow effect (multiple individuals with same genotype), and it can also happen if you do have enough loci to limit the shadow effect, but genotyping error rates are high and/or there are very low amplification rates for some samples. The latter can occur when using low quality samples with low amplification rates in model M0 sampType. This negative bias appears to be removed by increasing population size. I expect it would be removed by increasing detection probability. What I think is happening is this: if the genetic scores do not provide much information about which samples do not match, we rely on the abundance process and the detection processes for information to help split them apart. E.g., if an individual only has a few, say 1 or 2, low quality samples with low amplification and high genotyping error rates, just by chance they can be perfectly consistent with the true genotype of at least one other individual in the population that has high quality samples that provide abundant information about the true genotype. Then, we have only the abundance and detection process to help split these 2 individuals' samples into separate clusters. I believe without space, this model is still capable of that, but you need much more data to do so adequately, relative to a model using a spatial density and detection process. With space, there is more information in the density and detection processes and it is better able to split "nearly genetically identical" clusters like this. Perhaps using a 2 parameter detection process also contributes to making this more difficult without space because detection probability is estimated less precisely (e.g., may work better with Poisson assumption as used by Wright et al. 2009).

To sum this up, I think that without space, we have to scale back our ambitions about how little genetic information we can get by with.  Perhaps a good starting point is that you need enough loci that the shadow effect rarely happens, and then don't use low quality samples that amplify for less than, say, 75% of the replicate scores. Specific situations can be investigated via simulation.

2. For the y/ID update, I am using a proposal distribution that considers the "fit" of the sample with the true genotype of all individuals and also the "fit" of the sample with the observation model. It seems including the latter doesn't do much to improve mixing and only slows down the run time, but I'm leaving it in there. You can do it either way.


3. If the observed genotype data is very sparse and the false positive probabilities are initialized near 1, particularly for heterozygotes, it looks like it can get stuck there. The posterior is multimodal, but this mode is obviously the wrong one. In this case, initialize the genotyping error rates to realistic values or change the prior to reflect that false alleles are very rare.

4. You need "better data" for Mh as you do for regular capture-recapture. If individual heterogeneity is largely due to spatial juxtoposition of individuals and detectors, and you have the requisite spatial information recorded, perhaps try the genotype SPIM.